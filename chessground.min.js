!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}(function(){return function i(a,s,c){function l(r,e){if(!s[r]){if(!a[r]){var o="function"==typeof require&&require;if(!e&&o)return o(r,!0);if(u)return u(r,!0);var t=new Error("Cannot find module '"+r+"'");throw t.code="MODULE_NOT_FOUND",t}var n=s[r]={exports:{}};a[r][0].call(n.exports,function(e){return l(a[r][1][e]||e)},n,n.exports,i,a,s,c)}return s[r].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,r,o){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var r,o=1,t=arguments.length;o<t;o++)for(var n in r=arguments[o])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e};Object.defineProperty(o,"__esModule",{value:!0});var h=e("./util");function t(e,r){var o=e(r);return r.dom.redraw(),o}function g(e,r){return{key:e,pos:h.key2pos(e),piece:r}}o.anim=function(e,r){return r.animation.enabled?function(e,r){var o=a({},r.pieces),t=e(r),n=function(e,r){var o,t,n,i,a={},s=[],c={},l=[],u=[],d={};for(n in e)d[n]=g(n,e[n]);for(var p=0,f=h.allKeys;p<f.length;p++){var v=f[p];o=r.pieces[v],t=d[v],o?t?h.samePiece(o,t.piece)||(l.push(t),u.push(g(v,o))):u.push(g(v,o)):t&&l.push(t)}return u.forEach(function(r){var o,e;o=r,e=l.filter(function(e){return h.samePiece(r.piece,e.piece)}),(t=e.sort(function(e,r){return h.distanceSq(o.pos,e.pos)-h.distanceSq(o.pos,r.pos)})[0])&&(i=[t.pos[0]-r.pos[0],t.pos[1]-r.pos[1]],a[r.key]=i.concat(i),s.push(t.key))}),l.forEach(function(e){h.containsX(s,e.key)||r.items&&r.items(e.pos,e.key)||(c[e.key]=e.piece)}),{anims:a,fadings:c}}(o,r);if(s(n.anims)&&s(n.fadings))r.dom.redraw();else{var i=r.animation.current&&r.animation.current.start;r.animation.current={start:l.now(),frequency:1/r.animation.duration,plan:n},i||function r(o,e){var t=o.animation.current;if(void 0!==t){var n,i=1-(e-t.start)*t.frequency;if(i<=0)o.animation.current=void 0,o.dom.redrawNow();else{var a=(n=i)<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1;for(var s in t.plan.anims){var c=t.plan.anims[s];c[2]=c[0]*a,c[3]=c[1]*a}o.dom.redrawNow(!0),h.raf(function(e){return void 0===e&&(e=l.now()),r(o,e)})}}else o.dom.destroyed||o.dom.redrawNow()}(r,l.now())}return t}(e,r):t(e,r)},o.render=t;var l=void 0!==window.performance?window.performance:Date;function s(e){for(var r in e)return!1;return!0}},{"./util":17}],2:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./board"),i=e("./fen"),a=e("./config"),s=e("./anim"),c=e("./drag"),l=e("./explosion");o.start=function(t,e){function o(){n.toggleOrientation(t),e()}return{set:function(r){r.orientation&&r.orientation!==t.orientation&&o(),(r.fen?s.anim:s.render)(function(e){return a.configure(e,r)},t)},state:t,getFen:function(){return i.write(t.pieces)},toggleOrientation:o,setPieces:function(r){s.anim(function(e){return n.setPieces(e,r)},t)},selectSquare:function(r,o){r?s.anim(function(e){return n.selectSquare(e,r,o)},t):t.selected&&(n.unselect(t),t.dom.redraw())},move:function(r,o){console.log("ok"),s.anim(function(e){return n.baseMove(e,r,o)},t)},newPiece:function(r,o){s.anim(function(e){return n.baseNewPiece(e,r,o)},t)},playPremove:function(){if(t.premovable.current){if(s.anim(n.playPremove,t))return!0;t.dom.redraw()}return!1},playPredrop:function(e){if(t.predroppable.current){var r=n.playPredrop(t,e);return t.dom.redraw(),r}return!1},cancelPremove:function(){s.render(n.unsetPremove,t)},cancelPredrop:function(){s.render(n.unsetPredrop,t)},cancelMove:function(){s.render(function(e){n.cancelMove(e),c.cancel(e)},t)},stop:function(){s.render(function(e){n.stop(e),c.cancel(e)},t)},explode:function(e){l.default(t,e)},setAutoShapes:function(r){s.render(function(e){return e.drawable.autoShapes=r},t)},setShapes:function(r){s.render(function(e){return e.drawable.shapes=r},t)},getKeyAtDomPos:function(e){return n.getKeyAtDomPos(e,"white"===t.orientation,t.dom.bounds())},redrawAll:e,dragNewPiece:function(e,r,o){c.dragNewPiece(t,e,r,o)},destroy:function(){n.stop(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":9,"./fen":10}],3:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var f=e("./util"),v=e("./premove");function g(e){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];e&&setTimeout(function(){return e.apply(void 0,r)},1)}function b(e){e.premovable.current&&(e.premovable.current=void 0,g(e.premovable.events.unset))}function m(e){var r=e.predroppable;r.current&&(r.current=void 0,g(r.events.unset))}function n(e,r,o){if(r===o||!e.pieces[r])return!1;var t=e.pieces[o]&&e.pieces[o].color!==e.pieces[r].color?e.pieces[o]:void 0;return o==e.selected&&w(e),g(e.events.move,r,o,t),function(e,r,o){if(!e.autoCastle)return!1;var t=e.pieces[r];if("king"!==t.role)return!1;var n=f.key2pos(r);if(5!==n[0])return!1;if(1!==n[1]&&8!==n[1])return!1;var i,a,s,c=f.key2pos(o);if(7===c[0]||8===c[0])i=f.pos2key([8,n[1]]),a=f.pos2key([6,n[1]]),s=f.pos2key([7,n[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=f.pos2key([1,n[1]]),a=f.pos2key([4,n[1]]),s=f.pos2key([3,n[1]])}var l=e.pieces[i];return"rook"===l.role&&(delete e.pieces[r],delete e.pieces[i],e.pieces[s]=t,e.pieces[a]=l,!0)}(e,r,o)||(e.pieces[o]=e.pieces[r],delete e.pieces[r]),e.lastMove=[r,o],e.check=void 0,g(e.events.change),t||!0}function y(e,r,o,t){if(e.pieces[o]){if(!t)return!1;delete e.pieces[o]}return g(e.events.dropNewPiece,r,o),e.pieces[o]=r,e.lastMove=[o],e.check=void 0,g(e.events.change),e.movable.dests=void 0,e.turnColor=f.opposite(e.turnColor),!0}function h(e,r,o){var t=n(e,r,o);return t&&(e.movable.dests=void 0,e.turnColor=f.opposite(e.turnColor),e.animation.current=void 0),t}function t(e,r,o){if(C(e,r,o)){var t=h(e,r,o);if(t){var n=e.hold.stop();w(e);var i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:n};return!0!==t&&(i.captured=t),g(e.movable.events.after,r,o,i),!0}}else u=e,(d=r)!==(p=o)&&M(u,d)&&f.containsX(v.default(u.pieces,d),p)?(s=r,c=o,l={ctrlKey:(a=e).stats.ctrlKey},m(a),a.premovable.current=[s,c],g(a.premovable.events.set,s,c,l),w(e)):P(e,o)||M(e,o)?(k(e,o),e.hold.start()):w(e);var a,s,c,l,u,d,p;return!1}function k(e,r){e.selected=r,e.premovable.dests=v.default(e.pieces,r)}function w(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function P(e,r){var o=e.pieces[r];return o&&("both"===e.movable.color||e.movable.color===o.color&&e.turnColor===o.color)}function C(e,r,o){return r!==o&&!!e.premovable.dests&&f.containsX(e.premovable.dests,o)}function M(e,r){var o=e.pieces[r];return o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function i(e){b(e),m(e),w(e)}o.callUserFunction=g,o.toggleOrientation=function(e){e.orientation=f.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},o.reset=function(e){e.lastMove=void 0,w(e),b(e),m(e)},o.setPieces=function(e,r){for(var o in r){var t=r[o];t?e.pieces[o]=t:delete e.pieces[o]}},o.setCheck=function(e,r){if(!0===r&&(r=e.turnColor),r)for(var o in e.pieces)"king"===e.pieces[o].role&&e.pieces[o].color===r&&(e.check=o);else e.check=void 0},o.unsetPremove=b,o.unsetPredrop=m,o.baseMove=n,o.baseNewPiece=y,o.userMove=t,o.dropNewPiece=function(e,r,o,t){if(f=r,v=o,(h=(p=e).pieces[f])&&v&&(f===v||!p.pieces[v])&&("both"===p.movable.color||p.movable.color===h.color&&p.turnColor===h.color)||t){var n=e.pieces[r];delete e.pieces[r],y(e,n,o,t),g(e.movable.events.afterNewPiece,n.role,o,{predrop:!1})}else l=r,u=o,(d=(c=e).pieces[l])&&u&&(!c.pieces[u]||c.pieces[u].color!==c.movable.color)&&c.predroppable.enabled&&("pawn"!==d.role||"1"!==u[1]&&"8"!==u[1])&&c.movable.color===d.color&&c.turnColor!==d.color?(a=(i=e).pieces[r].role,s=o,b(i),i.predroppable.current={role:a,key:s},g(i.predroppable.events.set,a,s)):(b(e),m(e));var i,a,s,c,l,u,d,p,f,v,h;delete e.pieces[r],w(e)},o.selectSquare=function(e,r,o){e.selected?e.selected!==r||e.draggable.enabled?(e.selectable.enabled||o)&&e.selected!==r?t(e,e.selected,r)&&(e.stats.dragged=!1):e.hold.start():(w(e),e.hold.cancel()):(P(e,r)||M(e,r))&&(k(e,r),e.hold.start()),g(e.events.select,r)},o.setSelected=k,o.unselect=w,o.canMove=C,o.isDraggable=function(e,r){var o=e.pieces[r];return o&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))},o.playPremove=function(e){var r=e.premovable.current;if(!r)return!1;var o=r[0],t=r[1],n=!1;if(C(e,o,t)){var i=h(e,o,t);if(i){var a={premove:!0};!0!==i&&(a.captured=i),g(e.movable.events.after,o,t,a),n=!0}}return b(e),n},o.playPredrop=function(e,r){var o=e.predroppable.current,t=!1;return!!o&&(r(o)&&y(e,{role:o.role,color:e.movable.color},o.key)&&(g(e.movable.events.afterNewPiece,o.role,o.key,{predrop:!0}),t=!0),m(e),t)},o.cancelMove=i,o.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,i(e)},o.getKeyAtDomPos=function(e,r,o){var t=Math.ceil((e[0]-o.left)/o.width*9)-1;r||(t=8-t);var n=Math.ceil(9-(e[1]-o.top)/o.height*10);return r||(n=9-n),0<=t&&t<=8&&0<=n&&n<=9?f.pos2key([t,n]):void 0}},{"./premove":12,"./util":17}],4:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=e("./api"),n=e("./config"),i=e("./state"),u=e("./wrap"),d=e("./events"),p=e("./render"),f=e("./svg"),v=e("./util");o.Chessground=function(s,e){var c=i.defaults();function l(){var e=c.dom&&c.dom.unbind;s.classList.add("cg-board-wrap");var r,o,t=v.memo(function(){return s.getBoundingClientRect()}),n=c.viewOnly&&!c.drawable.visible,i=u.default(s,c,n?void 0:t()),a=function(e){p.default(c),!e&&i.svg&&f.renderSvg(c,i.svg)};c.dom={elements:i,bounds:t,redraw:(r=a,o=!1,function(){o||(o=!0,v.raf(function(){r(),o=!1}))}),redrawNow:a,unbind:e,relative:n},c.drawable.prevSvgHash="",a(!1),d.bindBoard(c),e||(c.dom.unbind=d.bindDocument(c,l))}return n.configure(c,e||{}),l(),t.start(c,l)}},{"./api":2,"./config":5,"./events":8,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],5:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("./board"),a=e("./fen");function s(e){return"object"==typeof e}o.configure=function(e,r){if(r.movable&&r.movable.dests&&(e.movable.dests=void 0),function e(r,o){for(var t in o)s(r[t])&&s(o[t])?e(r[t],o[t]):r[t]=o[t]}(e,r),r.fen&&(e.pieces=a.read(r.fen),e.drawable.shapes=[]),r.hasOwnProperty("check")&&i.setCheck(e,r.check||!1),r.hasOwnProperty("lastMove")&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&i.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var o="white"===e.movable.color?1:8,t="e"+o,n=e.movable.dests[t];if(!n||"king"!==e.pieces[t].role)return;e.movable.dests[t]=n.filter(function(e){return!(e==="a"+o&&-1!==n.indexOf("c"+o)||e==="h"+o&&-1!==n.indexOf("g"+o))})}}},{"./board":3,"./fen":10}],6:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=e("./draw"),b=e("./anim");function m(a){h.raf(function(){var e=a.draggable.current;if(e){a.animation.current&&a.animation.current.plan.anims[e.orig]&&(a.animation.current=void 0);var r=a.pieces[e.orig];if(r&&h.samePiece(r,e.piece)){if(!e.started&&h.distanceSq(e.epos,e.rel)>=Math.pow(a.draggable.distance,2)&&(e.started=!0),e.started){if("function"==typeof e.element){var o=e.element();if(!o)return;e.element=o,e.element.cgDragging=!0,e.element.classList.add("dragging")}var t="white"===a.orientation,n=a.dom.bounds();e.pos=[e.epos[0]-e.rel[0],e.epos[1]-e.rel[1]];var i=h.posToTranslateAbs(n)(e.origPos,t);i[0]+=e.pos[0]+e.dec[0],i[1]+=e.pos[1]+e.dec[1],h.translateAbs(e.element,i)}}else s(a);m(a)}})}function s(e){var r=e.draggable.current;r&&(r.newPiece&&delete e.pieces[r.orig],e.draggable.current=void 0,v.unselect(e),i(e),e.dom.redraw())}function i(e){var r=e.dom.elements;r.ghost&&h.setVisible(r.ghost,!1)}function y(e,r,o){var t=h.key2pos(e);return r||(t[0]=8-t[0],t[1]=9-t[1]),{left:o.left+o.width*t[0]/9,top:o.top+o.height*(9-t[1])/10,width:o.width/9,height:o.height/10}}function k(e,r){for(var o=e.dom.elements.board.firstChild;o;){if(o.cgKey===r&&"PIECE"===o.tagName)return o;o=o.nextSibling}}o.start=function(e,r){if(!(void 0!==r.button&&0!==r.button||r.touches&&1<r.touches.length)){r.preventDefault();var o="white"===e.orientation,t=e.dom.bounds(),n=h.eventPosition(r),i=v.getKeyAtDomPos(n,o,t);if(i){var a=e.pieces[i],s=e.selected;s||!e.drawable.enabled||!e.drawable.eraseOnClick&&a&&a.color===e.turnColor||g.clear(e);var c=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&v.canMove(e,e.selected,i)?b.anim(function(e){return v.selectSquare(e,i)},e):v.selectSquare(e,i);var u=e.selected===i,d=k(e,i);if(a&&d&&u&&v.isDraggable(e,i)){var p=y(i,o,t);e.draggable.current={orig:i,origPos:h.key2pos(i),piece:a,rel:n,epos:n,pos:[0,0],dec:e.draggable.centerPiece?[n[0]-(p.left+p.width/2),n[1]-(p.top+p.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:d,previouslySelected:s,originTarget:r.target},d.cgDragging=!0,d.classList.add("dragging");var f=e.dom.elements.ghost;f&&(f.className="ghost "+a.color+" "+a.role,h.translateAbs(f,h.posToTranslateAbs(t)(h.key2pos(i),o)),h.setVisible(f,!0)),m(e)}else c&&v.unsetPremove(e),l&&v.unsetPredrop(e);e.dom.redraw()}}},o.dragNewPiece=function(e,r,o,t){var n="00";e.pieces[n]=r,e.dom.redraw();var i=h.eventPosition(o),a="white"===e.orientation,s=e.dom.bounds(),c=y(n,a,s),l=[(a?0:8)*c.width+s.left,(a?9:0)*c.height+s.top];e.draggable.current={orig:n,origPos:h.key2pos(n),piece:r,rel:l,epos:i,pos:[i[0]-l[0],i[1]-l[1]],dec:[-c.width/2,-c.height/2],started:!0,element:function(){return k(e,n)},originTarget:o.target,newPiece:!0,force:t||!1},m(e)},o.move=function(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.epos=h.eventPosition(r))},o.end=function(e,r){var o=e.draggable.current;if(o)if("touchend"!==r.type||!o||o.originTarget===r.target||o.newPiece){v.unsetPremove(e),v.unsetPredrop(e);var t=h.eventPosition(r)||o.epos,n=v.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds());n&&o.started?o.newPiece?v.dropNewPiece(e,o.orig,n,o.force):(e.stats.ctrlKey=r.ctrlKey,v.userMove(e,o.orig,n)&&(e.stats.dragged=!0)):o.newPiece?delete e.pieces[o.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[o.orig],v.callUserFunction(e.events.change)),(!o||o.orig!==o.previouslySelected||o.orig!==n&&n)&&e.selectable.enabled||v.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},o.cancel=s},{"./anim":1,"./board":3,"./draw":7,"./util":17}],7:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=e("./board"),c=e("./util"),l=["green","red","blue","yellow"];function u(o){c.raf(function(){var e=o.drawable.current;if(e){var r=s.getKeyAtDomPos(e.pos,"white"===o.orientation,o.dom.bounds());r!==e.mouseSq&&(e.mouseSq=r,e.dest=r!==e.orig?r:void 0,o.dom.redrawNow()),u(o)}})}function d(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function p(e){e.onChange&&e.onChange(e.shapes)}o.start=function(e,r){if(!(r.touches&&1<r.touches.length)){r.stopPropagation(),r.preventDefault(),r.ctrlKey?s.unselect(e):s.cancelMove(e);var o,t,n,i=c.eventPosition(r),a=s.getKeyAtDomPos(i,"white"===e.orientation,e.dom.bounds());a&&(e.drawable.current={orig:a,pos:i,brush:(o=r,t=o.shiftKey&&c.isRightButton(o)?1:0,n=o.altKey?2:0,l[t+n])},u(e))}},o.processDraw=u,o.move=function(e,r){e.drawable.current&&(e.drawable.current.pos=c.eventPosition(r))},o.end=function(e){var r=e.drawable.current;r&&(r.mouseSq&&(o=e.drawable,t=r,i=function(e){return e.orig===t.orig&&e.dest===t.dest},a=o.shapes.filter(i)[0],a&&(o.shapes=o.shapes.filter((n=i,function(e){return!n(e)}))),a&&a.brush===t.brush||o.shapes.push(t),p(o)),d(e));var o,t,n,i,a},o.cancel=d,o.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),p(e.drawable))}},{"./board":3,"./util":17}],8:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=e("./drag"),s=e("./draw"),c=e("./util");function l(e,r,o,t){return e.addEventListener(r,o,t),function(){return e.removeEventListener(r,o)}}function u(r,o,t){return function(e){e.shiftKey||c.isRightButton(e)?r.drawable.enabled&&t(r,e):r.viewOnly||o(r,e)}}o.bindBoard=function(e){if(!e.viewOnly){var r,o=e.dom.elements.board,t=(r=e,function(e){r.draggable.current?a.cancel(r):r.drawable.current?s.cancel(r):e.shiftKey||c.isRightButton(e)?r.drawable.enabled&&s.start(r,e):r.viewOnly||a.start(r,e)});o.addEventListener("touchstart",t),o.addEventListener("mousedown",t),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",function(e){return e.preventDefault()})}},o.bindDocument=function(e,r){var o=[];!e.dom.relative&&e.resizable&&o.push(l(document.body,"chessground.resize",function(){e.dom.bounds.clear(),c.raf(r)}));if(!e.viewOnly){var t=u(e,a.move,s.move),n=u(e,a.end,s.end);["touchmove","mousemove"].forEach(function(e){return o.push(l(document,e,t))}),["touchend","mouseup"].forEach(function(e){return o.push(l(document,e,n))});var i=function(){return e.dom.bounds.clear()};o.push(l(window,"scroll",i,{passive:!0})),o.push(l(window,"resize",i,{passive:!0}))}return function(){return o.forEach(function(e){return e()})}}},{"./drag":6,"./draw":7,"./util":17}],9:[function(e,r,o){"use strict";function t(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(function(){t(e,2),setTimeout(function(){return t(e,void 0)},120)},120)}},{}],10:[function(e,r,l){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var u=e("./util"),i=e("./types");l.initial="rnbqkqbnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P1/1C5C1/9/RNBQKQBNR";var d={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",c:"canon"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k",canon:"c"};l.read=function(e){"start"===e&&(e=l.initial);for(var r={},o=9,t=0,n=0,i=e;n<i.length;n++){var a=i[n];switch(a){case" ":return r;case"/":if(--o<0)return r;t=0;break;case"~":r[u.pos2key([t,o])].promoted=!0;break;default:var s=a.charCodeAt(0);if(s<=57)t+=s-48;else{var c=a.toLowerCase();r[u.pos2key([t,o])]={role:d[c],color:a===c?"black":"white"},++t}}}return r},l.write=function(o){var t,n;return u.invRanks.map(function(r){return i.files.map(function(e){return(t=o[u.pos2key([e,r])])?(n=a[t.role],"white"===t.color?n.toUpperCase():n):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":16,"./util":17}],11:[function(e,r,o){r.exports=e("./chessground").Chessground},{"./chessground":4}],12:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var X=e("./util");o.default=function(e,r){var o=e[r],t=X.key2pos(r),n=[];switch(o.role){case"pawn":if("white"===o.color){var i=X.pos2key([t[0],t[1]+1]);if(t[1]<=8&&(!e[i]||e[i].color!==o.color)&&n.push(i),1<=t[0]&&5<=t[1]){var a=X.pos2key([t[0]-1,t[1]]);e[a]&&e[a].color===o.color||n.push(a)}if(t[0]<=7&&5<=t[1]){var s=X.pos2key([t[0]+1,t[1]]);e[s]&&e[s].color===o.color||n.push(s)}}else{if(i=X.pos2key([t[0],t[1]-1]),1<=t[1]&&(!e[i]||e[i].color!==o.color)&&n.push(i),1<=t[0]&&t[1]<=4){var c=X.pos2key([t[0]-1,t[1]]);e[c]&&e[c].color===o.color||n.push(c)}if(t[0]<=7&&t[1]<=4){var l=X.pos2key([t[0]+1,t[1]]);e[l]&&e[l].color===o.color||n.push(l)}}break;case"knight":if(t[1]<=7&&!e[X.pos2key([t[0],t[1]+1])]){var u=X.pos2key([t[0]-1,t[1]+2]);1<=t[0]&&(!e[u]||e[u].color!==o.color)&&n.push(u);var d=X.pos2key([t[0]+1,t[1]+2]);t[0]<=7&&(!e[d]||e[d].color!==o.color)&&n.push(d)}if(2<=t[1]&&!e[X.pos2key([t[0],t[1]-1])]){var p=X.pos2key([t[0]-1,t[1]-2]);1<=t[0]&&(!e[p]||e[p].color!==o.color)&&n.push(p);var f=X.pos2key([t[0]+1,t[1]-2]);t[0]<=7&&(!e[f]||e[f].color!==o.color)&&n.push(f)}if(2<=t[0]&&!e[X.pos2key([t[0]-1,t[1]])]){var v=X.pos2key([t[0]-2,t[1]-1]);1<=t[1]&&(!e[v]||e[v].color!==o.color)&&n.push(v);var h=X.pos2key([t[0]-2,t[1]+1]);1<=t[1]&&(!e[h]||e[h].color!==o.color)&&n.push(h)}if(t[0]<=6&&!e[X.pos2key([t[0]+1,t[1]])]){var g=X.pos2key([t[0]+2,t[1]-1]);1<=t[1]&&(!e[g]||e[g].color!==o.color)&&n.push(g);var b=X.pos2key([t[0]+2,t[1]+1]);1<=t[1]&&(!e[b]||e[b].color!==o.color)&&n.push(b)}break;case"bishop":if("black"===o.color||"white"===o.color&&t[1]<=2){var m=X.pos2key([t[0]-1,t[1]+1]);if(m&&!e[m]){var y=X.pos2key([t[0]-2,t[1]+2]);(y&&!e[y]||e[y].color!==o.color)&&n.push(y)}var k=X.pos2key([t[0]+1,t[1]+1]);if(k&&!e[k]){var w=X.pos2key([t[0]+2,t[1]+2]);(w&&!e[w]||e[w].color!==o.color)&&n.push(w)}}if("white"===o.color||"black"===o.color&&7<=t[1]){var P=X.pos2key([t[0]-1,t[1]-1]);if(P&&!e[P]){var C=X.pos2key([t[0]-2,t[1]-2]);(C&&!e[C]||e[C].color!==o.color)&&n.push(C)}var M=X.pos2key([t[0]+1,t[1]-1]);if(M&&!e[M]){var O=X.pos2key([t[0]+2,t[1]-2]);(O&&!e[O]||e[O].color!==o.color)&&n.push(O)}}break;case"rook":for(var x=t[0]-1;0<=x;x--){if(e[D=X.pos2key([x,t[1]])]){e[D]&&o.color!==e[D].color&&n.push(D);break}n.push(D)}for(x=t[0]+1;x<=8;x++){if(e[D=X.pos2key([x,t[1]])]){e[D]&&o.color!==e[D].color&&n.push(D);break}n.push(D)}for(var _=t[1]+1;_<=9;_++){if(e[D=X.pos2key([t[0],_])]){e[D]&&o.color!==e[D].color&&n.push(D);break}n.push(D)}for(_=t[1]-1;0<=_;_--){if(e[D=X.pos2key([t[0],_])]){e[D]&&o.color!==e[D].color&&n.push(D);break}n.push(D)}break;case"canon":var S=void 0,E=void 0,A=void 0,K=void 0;for(x=t[0]-1;0<=x;x--)if(e[D=X.pos2key([x,t[1]])]||A){if(e[D]&&!A)A=e[D];else if(e[D]&&A){n.push(D);break}}else n.push(D);for(x=t[0]+1;x<=8;x++)if(e[D=X.pos2key([x,t[1]])]||K){if(e[D]&&!K)K=e[D];else if(e[D]&&K){n.push(D);break}}else n.push(D);for(_=t[1]+1;_<=9;_++)if(e[D=X.pos2key([t[0],_])]||S){if(e[D]&&!S)S=e[D];else if(e[D]&&S){n.push(D);break}}else n.push(D);for(_=t[1]-1;0<=_;_--){var D;if(e[D=X.pos2key([t[0],_])]||E){if(e[D]&&!E)E=e[D];else if(e[D]&&E){n.push(D);break}}else n.push(D)}break;case"queen":var j=X.pos2key([t[0]-1,t[1]+1]);!j||e[j]&&e[j].color===o.color||!("white"===o.color&&(4===t[0]||5===t[0]&&0===t[1])||"black"===o.color&&(4===t[0]||5===t[0]&&7===t[1]))||n.push(j);var q=X.pos2key([t[0]+1,t[1]+1]);!q||e[q]&&e[q].color===o.color||!("white"===o.color&&(4===t[0]||3===t[0]&&0===t[1])||"black"===o.color&&(4===t[0]||3===t[0]&&7===t[1]))||n.push(q);var T=X.pos2key([t[0]-1,t[1]-1]);!T||e[T]&&e[T].color===o.color||!("white"===o.color&&(4===t[0]||5===t[0]&&2===t[1])||"black"===o.color&&(4===t[0]||5===t[0]&&9===t[1]))||n.push(T);var N=X.pos2key([t[0]+1,t[1]-1]);!N||e[N]&&e[N].color===o.color||!("white"===o.color&&(4===t[0]||3===t[0]&&2===t[1])||"black"===o.color&&(4===t[0]||3===t[0]&&9===t[1]))||n.push(N);break;case"king":var L=X.pos2key([t[0],t[1]+1]);!L||e[L]&&e[L].color===o.color||!("white"===o.color&&t[1]<=1||"black"===o.color&&t[1]<=8)||n.push(L);var R=X.pos2key([t[0],t[1]-1]);!R||e[R]&&e[R].color===o.color||!("white"===o.color&&1<=t[1]||"black"===o.color&&8<=t[1])||n.push(R);var W=X.pos2key([t[0]-1,t[1]]);!W||e[W]&&e[W].color===o.color||!("white"===o.color&&4<=t[0]||"black"===o.color&&4<=t[0])||n.push(W);var B=X.pos2key([t[0]+1,t[1]]);if(!B||e[B]&&e[B].color===o.color||!("white"===o.color&&t[0]<=4||"black"===o.color&&t[0]<=4)||n.push(B),"white"===o.color){var F=X.pos2key([t[0],7]),I=X.pos2key([t[0],8]);if("king"===(e[X.pos2key([t[0],9])]||{}).role||"king"===(e[I]||{}).role||"king"===(e[F]||{}).role)for(_=t[1]+1;_<=9;_++)if(e[U=X.pos2key([t[0],_])]){if(e[U]&&"king"!==e[U].role)break;n.push(U);break}}else if(F=X.pos2key([t[0],0]),I=X.pos2key([t[0],1]),"king"===(e[X.pos2key([t[0],2])]||{}).role||"king"===(e[I]||{}).role||"king"===(e[F]||{}).role)for(_=t[1]-1;0<=_;_--){var U;if(e[U=X.pos2key([t[0],_])]){if(e[U]&&"king"!==e[U].role)break;n.push(U);break}}}return n}},{"./util":17}],13:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var N=e("./util"),L=e("./util");function R(e,r){for(var o in r)e.dom.elements.board.removeChild(r[o])}function W(e,r){var o=2+10*(e[1]-1)+(9-e[0]);return r&&(o=67-o),o+""}function B(e){return e.color+" "+e.role}function F(e,r,o){e[r]?e[r]+=" "+o:e[r]=o}o.default=function(e){var r,o,t,n,i,a,s,c,l,u,d,p="white"===e.orientation,f=e.dom.relative?L.posToTranslateRel:L.posToTranslateAbs(e.dom.bounds()),v=e.dom.relative?L.translateRel:L.translateAbs,h=e.dom.elements.board,g=e.pieces,b=e.animation.current,m=b?b.plan.anims:{},y=b?b.plan.fadings:{},k=e.draggable.current,w=function(e){var r,o,t={};if(e.lastMove&&e.highlight.lastMove)for(r in e.lastMove)F(t,e.lastMove[r],"last-move");if(e.check&&e.highlight.check&&F(t,e.check,"check"),e.selected&&(F(t,e.selected,"selected"),e.movable.showDests)){var n=e.movable.dests&&e.movable.dests[e.selected];if(n)for(r in n)o=n[r],F(t,o,"move-dest"+(e.pieces[o]?" oc":""));var i=e.premovable.dests;if(i)for(r in i)o=i[r],F(t,o,"premove-dest"+(e.pieces[o]?" oc":""))}var a=e.premovable.current;if(a)for(r in a)F(t,a[r],"current-premove");else e.predroppable.current&&F(t,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(r in s.keys)F(t,s.keys[r],"exploding"+s.stage);return t}(e),P={},C={},M={},O={},x=Object.keys(g);for(t=h.firstChild;t;){if(r=t.cgKey,"PIECE"===t.tagName)n=g[r],a=m[r],s=y[r],i=t.cgPiece,!t.cgDragging||k&&k.orig===r||(t.classList.remove("dragging"),v(t,f(N.key2pos(r),p)),t.cgDragging=!1),!s&&t.cgFading&&(t.cgFading=!1,t.classList.remove("fading")),n?(a&&t.cgAnimating&&i===B(n)?((D=N.key2pos(r))[0]+=a[2],D[1]+=a[3],t.classList.add("anim"),v(t,f(D,p))):t.cgAnimating&&(t.cgAnimating=!1,t.classList.remove("anim"),v(t,f(N.key2pos(r),p)),e.addPieceZIndex&&(t.style.zIndex=W(N.key2pos(r),p))),i!==B(n)||s&&t.cgFading?s&&i===B(s)?(t.classList.add("fading"),t.cgFading=!0):M[i]?M[i].push(t):M[i]=[t]:P[r]=!0):M[i]?M[i].push(t):M[i]=[t];else if("SQUARE"===t.tagName){var _=t.className;w[r]===_?C[r]=!0:O[_]?O[_].push(t):O[_]=[t]}t=t.nextSibling}for(var S in w)if(!C[S]){d=(u=O[w[S]])&&u.pop();var E=f(N.key2pos(S),p);if(d)d.cgKey=S,v(d,E);else{var A=N.createEl("square",w[S]);A.cgKey=S,v(A,E),h.insertBefore(A,h.firstChild)}}for(var K in x)if(o=g[r=x[K]],a=m[r],!P[r])if(l=(c=M[B(o)])&&c.pop()){l.cgKey=r,l.cgFading&&(l.classList.remove("fading"),l.cgFading=!1);var D=N.key2pos(r);e.addPieceZIndex&&(l.style.zIndex=W(D,p)),a&&(l.cgAnimating=!0,l.classList.add("anim"),D[0]+=a[2],D[1]+=a[3]),v(l,f(D,p))}else{var j=B(o),q=N.createEl("piece",j);D=N.key2pos(r),q.cgPiece=j,q.cgKey=r,a&&(q.cgAnimating=!0,D[0]+=a[2],D[1]+=a[3]),v(q,f(D,p)),e.addPieceZIndex&&(q.style.zIndex=W(D,p)),h.appendChild(q)}for(var T in M)R(e,M[T]);for(var T in O)R(e,O[T])}},{"./util":17}],14:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=e("./fen"),n=e("./util");o.defaults=function(){return{pieces:t.read(t.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:n.timer()}}},{"./fen":10,"./util":17}],15:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var X,H=e("./util");function z(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function l(e,r,o){var t,n,i=e.orig,a=e.dest,s=e.brush,c=e.piece,l=e.modifiers;return[o,i,a,s,a&&1<r[a],c&&(n=c,[n.color,n.role,n.scale].filter(function(e){return e}).join("")),l&&(t=l,""+(t.lineWidth||""))].filter(function(e){return e}).join("")}function u(e){var r=V(z("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(V(z("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function V(e,r){for(var o in r)e.setAttribute(o,r[o]);return e}function Z(e,r){return"white"===r?e:[8-e[0],9-e[1]]}function G(e,r){var o={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth)};return o.key=[e.key,r.lineWidth].filter(function(e){return e}).join(""),o}function Q(e,r){return(e.opacity||1)*(r?.9:1)}function Y(e,r){return[(e[0]+.5)*r.width/9,(9.5-e[1])*r.height/10]}o.createElement=z,o.renderSvg=function(e,r){var o=e.drawable,t=o.current,n=t&&t.mouseSq?t:void 0,i={};o.shapes.concat(o.autoShapes).concat(n?[n]:[]).forEach(function(e){e.dest&&(i[e.dest]=(i[e.dest]||0)+1)});var a=o.shapes.concat(o.autoShapes).map(function(e){return{shape:e,current:!1,hash:l(e,i,!1)}});n&&a.push({shape:n,current:!0,hash:l(n,i,!0)});var s=a.map(function(e){return e.hash}).join("");if(s!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=s;var c=r.firstChild;!function(r,e,o){var t,n={};e.forEach(function(e){e.shape.dest&&(t=r.brushes[e.shape.brush],e.shape.modifiers&&(t=G(t,e.shape.modifiers)),n[t.key]=t)});for(var i={},a=o.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in n)i[s]||o.appendChild(u(n[s]))}(o,a,c),function(r,e,o,t,n,i){void 0===X&&(X=H.computeIsTrident());var a=r.dom.bounds(),s={},c=[];e.forEach(function(e){s[e.hash]=!1});for(var l,u=i.nextSibling;u;)l=u.getAttribute("cgHash"),s.hasOwnProperty(l)?s[l]=!0:c.push(u),u=u.nextSibling;c.forEach(function(e){return n.removeChild(e)}),e.forEach(function(e){s[e.hash]||n.appendChild(function(e,r,o,t,n){var i,a,s,c,l,u,d,p,f,v,h,g,b,m,y,k,w,P,C,M,O,x,_,S,E,A,K,D,j,q,T,N,L,R,W=r.shape,B=r.current,F=r.hash;if(W.piece)D=e.drawable.pieces.baseUrl,j=Z(H.key2pos(W.orig),e.orientation),q=W.piece,N=Y(j,T=n),L=T.width/9*(q.scale||1),R=q.color[0]+("knight"===q.role?"n":q.role[0]).toUpperCase(),i=V(z("image"),{className:q.role+" "+q.color,x:N[0]-L/2,y:N[1]-L/2,width:L,height:L,href:D+R+".svg"});else{var I=Z(H.key2pos(W.orig),e.orientation);if(W.orig&&W.dest){var U=o[W.brush];W.modifiers&&(U=G(U,W.modifiers)),f=U,v=I,h=Z(H.key2pos(W.dest),e.orientation),g=B,b=1<t[W.dest],_=m=n,S=b&&!g,y=X?0:(S?20:10)/512*_.width,k=Y(v,m),w=Y(h,m),P=w[0]-k[0],C=w[1]-k[1],M=Math.atan2(C,P),O=Math.cos(M)*y,x=Math.sin(M)*y,i=V(z("line"),{stroke:f.color,"stroke-width":(E=f,A=g,K=m,(E.lineWidth||10)*(A?.95:1)/720*K.width),"stroke-linecap":"round","marker-end":X?void 0:"url(#arrowhead-"+f.key+")",opacity:Q(f,g),x1:k[0],y1:k[1],x2:w[0]-O,y2:w[1]-x})}else a=o[W.brush],s=B,l=Y(I,c=n),p=c.width/720,u=[3*p,4*p],d=(c.width+c.height)/40,i=V(z("circle"),{stroke:a.color,"stroke-width":u[s?0:1],fill:"none",opacity:Q(a,s),cx:l[0],cy:l[1],r:d-u[0]/2})}return i.setAttribute("cgHash",F),i}(r,e,o,t,a))})}(e,a,o.brushes,i,r,c)}}},{"./util":17}],16:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.files=[0,1,2,3,4,5,6,7,8],o.ranks=[0,1,2,3,4,5,6,7,8,9]},{}],17:[function(e,r,o){"use strict";var t;Object.defineProperty(o,"__esModule",{value:!0});var n=e("./types");o.colors=["white","black"],o.invRanks=[9,8,7,6,5,4,3,2,1,0],o.invFiles=[8,7,6,5,4,3,2,1,0],o.allKeys=(t=Array.prototype).concat.apply(t,n.files.map(function(r){return n.ranks.map(function(e){return r+""+e})})),o.pos2key=function(e){return o.allKeys[10*e[0]+e[1]]},o.key2pos=function(e){return[e.charCodeAt(0)-48,e.charCodeAt(1)-48]},o.memo=function(e){var r,o=function(){return void 0===r&&(r=e()),r};return o.clear=function(){r=void 0},o},o.timer=function(){var r;return{start:function(){r=Date.now()},cancel:function(){r=void 0},stop:function(){if(!r)return 0;var e=Date.now()-r;return r=void 0,e}}},o.opposite=function(e){return"white"===e?"black":"white"},o.containsX=function(e,r){return void 0!==e&&-1!==e.indexOf(r)},o.distanceSq=function(e,r){return Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)},o.samePiece=function(e,r){return e.role===r.role&&e.color===r.color},o.computeIsTrident=function(){return-1<window.navigator.userAgent.indexOf("Trident/")};var i=function(e,r,o,t){return[(r?e[0]:9-e[0]-1)*o,(r?10-e[1]-1:e[1])*t]};o.posToTranslateAbs=function(e){var o=e.width/9,t=e.height/10;return function(e,r){return i(e,r,o,t)}},o.posToTranslateRel=function(e,r){return i(e,r,12.5,12.5)},o.translateAbs=function(e,r){e.style.transform="translate("+r[0]+"px,"+r[1]+"px)"},o.translateRel=function(e,r){e.style.left=r[0]+"%",e.style.top=r[1]+"%"},o.setVisible=function(e,r){e.style.visibility=r?"visible":"hidden"},o.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},o.isRightButton=function(e){return 2===e.buttons||2===e.button},o.createEl=function(e,r){var o=document.createElement(e);return r&&(o.className=r),o},o.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=e("./util"),c=e("./types"),l=e("./svg");function u(e,r){var o,t=s.createEl("coords",r);for(var n in e)(o=s.createEl("coord")).textContent=e[n],t.appendChild(o);return t}o.default=function(r,o,e){r.innerHTML="",r.classList.add("cg-board-wrap"),s.colors.forEach(function(e){r.classList.toggle("orientation-"+e,o.orientation===e)}),r.classList.toggle("manipulable",!o.viewOnly);var t,n,i=s.createEl("div","cg-board");if(r.appendChild(i),o.drawable.visible&&e&&((t=l.createElement("svg")).appendChild(l.createElement("defs")),r.appendChild(t)),o.coordinates){var a="black"===o.orientation?" black":"";r.appendChild(u(c.ranks,"ranks"+a)),r.appendChild(u(c.files,"files"+a))}return e&&o.draggable.showGhost&&(n=s.createEl("piece","ghost"),s.setVisible(n,!1),r.appendChild(n)),{board:i,ghost:n,svg:t}}},{"./svg":15,"./types":16,"./util":17}]},{},[11])(11)});